name: Organization Project Auto-Date
on:
  projects_v2_item:
    types: [created, edited, reordered]

jobs:
  update-dates:
    runs-on: ubuntu-latest
    steps:
      - name: Update Fields
        env:
          GH_TOKEN: ${{ secrets.TEST_PROJECT_TOKEN }}
          FIELD_CREATED: "added"
          FIELD_UPDATED: "edited"
          PROJECT_ID: ${{ github.event.project_v2_item.project_node_id }}
          ITEM_ID: ${{ github.event.project_v2_item.node_id }}
          EVENT_ACTION: ${{ github.event.action }}
        run: |
          NOW=$(date -u +"%Y-%m-%d")

          # 1. Always update the field tracking the last edit
          gh project item-edit --project-id "$PROJECT_ID" --id "$ITEM_ID" --field "$FIELD_UPDATED" --date "$NOW"

          # 2. If the item was just created in the project, also set the created date
          if [ "$EVENT_ACTION" = "created" ]; then
            gh project item-edit --project-id "$PROJECT_ID" --id "$ITEM_ID" --field "$FIELD_CREATED" --date "$NOW"
          fi