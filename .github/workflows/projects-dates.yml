name: Organization Project Auto-Date
on:
  project_v2_item:
    types: [created, edited, reordered]

jobs:
  update-dates:
    runs-on: ubuntu-latest
    steps:
      - name: Update Fields
        env:
          GH_TOKEN: ${{ secrets.TEST_PROJECT_TOKEN }}
          FIELD_CREATED: "added"   # Název vašeho sloupce v projektu
          FIELD_UPDATED: "edited"  # Název vašeho sloupce v projektu
          PROJECT_ID: ${{ github.event.project_v2_item.project_node_id }}
          ITEM_ID: ${{ github.event.project_v2_item.node_id }}
        run: |
          NOW=$(date -u +"%Y-%m-%d")

          # 1. Vždy aktualizuj 'edited'
          gh project item-edit --id "$ITEM_ID" --field "$FIELD_UPDATED" --date "$NOW"

          # 2. Pokud je to nová položka, nastav 'added'
          if [ "${{ github.event.action }}" = "created" ]; then
            gh project item-edit --id "$ITEM_ID" --field "$FIELD_CREATED" --date "$NOW"
          fi